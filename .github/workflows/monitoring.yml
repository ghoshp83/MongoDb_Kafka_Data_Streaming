name: Monitoring & Health Checks

on:
  schedule:
    - cron: '*/30 * * * *'  # Every 30 minutes
  workflow_dispatch:

jobs:
  health-check:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Check GitHub Actions Status
      run: |
        echo "Checking recent workflow runs..."
        # This would typically check external deployments
        # For demo purposes, we'll check the repository status
        
    - name: Check Dependencies Health
      run: |
        echo "Checking dependency health..."
        # Check repository security status
        RESPONSE=$(curl -s "https://api.github.com/repos/${{ github.repository }}" \
          -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          -H "Accept: application/vnd.github.v3+json")
        
        if echo "$RESPONSE" | jq -e '.security_and_analysis' > /dev/null 2>&1; then
          echo "âœ… Repository security features enabled"
        else
          echo "âš ï¸ Repository security status unknown"
        fi
        
        echo "âœ… Dependency health check completed"
    
    - name: Repository Health Check
      run: |
        echo "## Repository Health Status" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Repository accessible" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Latest commit: $(git log -1 --format='%h %s')" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Branch: ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
        
    - name: Notify on failure
      if: failure()
      run: |
        echo "ðŸš¨ Health check failed for repository ${{ github.repository }}"
        # In a real scenario, this would send notifications to Slack, email, etc.